<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cervical Cancer Risk Assessment</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script>
        function toggleBleedingType() {
            document.getElementById('bleeding_type').style.display = 
                document.getElementById('abnormal_bleeding_yes').checked ? 'block' : 'none';
            updateProgress();
        }
        function toggleContraceptiveYears() {
            document.getElementById('contraceptive_use_years').style.display = 
                document.getElementById('contraceptive_use_yes').checked ? 'block' : 'none';
            updateProgress();
        }
        function toggleCigarettesPerDay() {
            document.getElementById('cigarettes_per_day').style.display = 
                document.getElementById('smoking_status').value === 'Current' ? 'block' : 'none';
            updateProgress();
        }
        function togglePapResult() {
            document.getElementById('pap_result').style.display = 
                document.getElementById('had_pap_smear_yes').checked ? 'block' : 'none';
            updateProgress();
        }
        function toggleEthnicityOther() {
            document.getElementById('ethnicity_other').style.display = 
                document.getElementById('ethnicity').value === 'Other' ? 'block' : 'none';
            updateProgress();
        }

        // Progress bar logic
        function updateProgress() {
            const requiredFields = document.querySelectorAll('input[required], select[required]');
            let filled = 0;
            requiredFields.forEach(field => {
                if (field.type === 'radio') {
                    const radioGroup = document.querySelector(`input[name="${field.name}"]:checked`);
                    if (radioGroup) filled++;
                } else if (field.value) {
                    filled++;
                }
            });
            const uniqueRadioGroups = new Set(Array.from(requiredFields)
                .filter(field => field.type === 'radio')
                .map(field => field.name)).size;
            const totalFields = requiredFields.length - uniqueRadioGroups + (uniqueRadioGroups / 2);
            const progress = (filled / totalFields) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `${Math.round(progress)}% Complete`;
        }

        // Section navigation logic
        function showNextSection(currentSectionId, nextSectionId) {
            const currentSection = document.getElementById(currentSectionId);
            const requiredFields = currentSection.querySelectorAll('input[required], select[required]');
            let allFilled = true;

            requiredFields.forEach(field => {
                if (field.type === 'radio') {
                    const radioGroup = currentSection.querySelector(`input[name="${field.name}"]:checked`);
                    if (!radioGroup) allFilled = false;
                } else if (!field.value) {
                    allFilled = false;
                }
            });

            if (allFilled) {
                document.getElementById(nextSectionId).style.display = 'block';
                // Optionally hide the current section
                // currentSection.style.display = 'none';
            } else {
                alert('Please complete all required fields in this section.');
            }
        }

        // Initialize form
        window.onload = function() {
            console.log('Initializing form...');
            // Ensure demographic-info is visible
            document.getElementById('demographic-info').style.display = 'block';
            // Hide other sections
            document.getElementById('primary-symptoms').style.display = 'none';
            document.getElementById('additional-symptoms').style.display = 'none';
            document.getElementById('risk-factors').style.display = 'none';
            updateProgress();
            document.querySelectorAll('input, select').forEach(field => {
                field.addEventListener('change', updateProgress);
            });
            console.log('Form initialized, demographic-info should be visible');
        };
    </script>
</head>
<body>
    <div class="container">
        <h1>Cervical Cancer Risk Assessment Tool</h1>
        <p>Designed to promote preventive healthcare for women</p>
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
            <span id="progress-text">0% Complete</span>
        </div>
        {% if error %}
            <div class="error">{{ error }}</div>
        {% endif %}
        <form method="POST" action="/">
            <fieldset class="section" id="demographic-info" style="display: block;">
                <legend>Demographic Information</legend>
                <div class="form-row">
                    <div class="form-group">
                        <label for="full_name">Full Name (including middle initial):</label>
                        <input type="text" id="full_name" name="full_name" required>
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth:</label>
                        <input type="date" id="dob" name="dob" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="address">Address:</label>
                        <input type="text" id="address" name="address" required>
                    </div>
                    <div class="form-group">
                        <label for="ethnicity">Ethnicity:</label>
                        <select id="ethnicity" name="ethnicity" onchange="toggleEthnicityOther()" required>
                            <option value="">Select</option>
                            <option value="Hausa">Hausa</option>
                            <option value="Yoruba">Yoruba</option>
                            <option value="Igbo">Igbo</option>
                            <option value="Fulani">Fulani</option>
                            <option value="Kanuri">Kanuri</option>
                            <option value="Other">Other</option>
                        </select>
                        <div id="ethnicity_other" style="display:none;">
                            <label for="ethnicity_other_input">Please specify:</label>
                            <input type="text" id="ethnicity_other_input" name="ethnicity_other_input">
                        </div>
                    </div>
                </div>
                <button type="button" class="next-btn" onclick="showNextSection('demographic-info', 'primary-symptoms')">Next</button>
            </fieldset>

            <fieldset class="section" id="primary-symptoms">
                <legend>Primary Symptoms</legend>
                <div class="form-group">
                    <label>Do you have abnormal vaginal bleeding?</label>
                    <input type="radio" id="abnormal_bleeding_yes" name="abnormal_bleeding" value="yes" onchange="toggleBleedingType()" required>
                    <label for="abnormal_bleeding_yes">Yes</label>
                    <input type="radio" id="abnormal_bleeding_no" name="abnormal_bleeding" value="no" onchange="toggleBleedingType()" required>
                    <label for="abnormal_bleeding_no">No</label>
                    <div id="bleeding_type" style="display:none;">
                        <label for="bleeding_type">What type of abnormal bleeding?</label>
                        <select id="bleeding_type" name="bleeding_type">
                            <option value="">Select</option>
                            <option value="intermenstrual">Intermenstrual</option>
                            <option value="post-coital">Post-coital</option>
                            <option value="heavier periods">Heavier periods</option>
                            <option value="postmenopausal">Postmenopausal</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Do you have abnormal vaginal discharge?</label>
                    <input type="radio" id="abnormal_discharge_yes" name="abnormal_discharge" value="yes" required>
                    <label for="abnormal_discharge_yes">Yes</label>
                    <input type="radio" id="abnormal_discharge_no" name="abnormal_discharge" value="no" required>
                    <label for="abnormal_discharge_no">No</label>
                </div>
                <div class="form-group">
                    <label>Do you have lower abdominal pain?</label>
                    <input type="radio" id="lower_abdominal_pain_yes" name="lower_abdominal_pain" value="yes" required>
                    <label for="lower_abdominal_pain_yes">Yes</label>
                    <input type="radio" id="lower_abdominal_pain_no" name="lower_abdominal_pain" value="no" required>
                    <label for="lower_abdominal_pain_no">No</label>
                </div>
                <button type="button" class="next-btn" onclick="showNextSection('primary-symptoms', 'additional-symptoms')">Next</button>
            </fieldset>

            <fieldset class="section" id="additional-symptoms">
                <legend>Additional Symptoms</legend>
                <div class="form-group">
                    <label>Is sexual intercourse painful for you?</label>
                    <input type="radio" id="painful_intercourse_yes" name="painful_intercourse" value="yes" required>
                    <label for="painful_intercourse_yes">Yes</label>
                    <input type="radio" id="painful_intercourse_no" name="painful_intercourse" value="no" required>
                    <label for="painful_intercourse_no">No</label>
                </div>
                {% if request.form.get('dob') %}
                    {% set age = calculate_age(request.form.get('dob')) %}
                    {% if age < 50 %}
                        <div class="form-group">
                            <label>Are you experiencing a change in your menstrual periods?</label>
                            <input type="radio" id="changed_periods_yes" name="changed_periods" value="yes" required>
                            <label for="changed_periods_yes">Yes</label>
                            <input type="radio" id="changed_periods_no" name="changed_periods" value="no" required>
                            <label for="changed_periods_no">No</label>
                            <input type="hidden" name="show_changed_periods" value="yes">
                        </div>
                    {% else %}
                        <p>(Postmenopausal - period change question skipped)</p>
                        <input type="hidden" name="show_changed_periods" value="no">
                    {% endif %}
                {% else %}
                    <div class="form-group">
                        <label>Are you experiencing a change in your menstrual periods?</label>
                        <input type="radio" id="changed_periods_yes" name="changed_periods" value="yes" required>
                        <label for="changed_periods_yes">Yes</label>
                        <input type="radio" id="changed_periods_no" name="changed_periods" value="no" required>
                        <label for="changed_periods_no">No</label>
                        <input type="hidden" name="show_changed_periods" value="yes">
                    </div>
                {% endif %}
                <div class="form-group">
                    <label>Are you having unexplained weight loss?</label>
                    <input type="radio" id="weight_loss_yes" name="weight_loss" value="yes" required>
                    <label for="weight_loss_yes">Yes</label>
                    <input type="radio" id="weight_loss_no" name="weight_loss" value="no" required>
                    <label for="weight_loss_no">No</label>
                </div>
                <div class="form-group">
                    <label>Are you experiencing unusual fatigue?</label>
                    <input type="radio" id="unusual_fatigue_yes" name="unusual_fatigue" value="yes" required>
                    <label for="unusual_fatigue_yes">Yes</label>
                    <input type="radio" id="unusual_fatigue_no" name="unusual_fatigue" value="no" required>
                    <label for="unusual_fatigue_no">No</label>
                </div>
                <button type="button" class="next-btn" onclick="showNextSection('additional-symptoms', 'risk-factors')">Next</button>
            </fieldset>

            <fieldset class="section" id="risk-factors">
                <legend>Risk Factors</legend>
                <div class="form-group">
                    <label>Are you currently pregnant?</label>
                    <input type="radio" id="is_pregnant_yes" name="is_pregnant" value="yes" required>
                    <label for="is_pregnant_yes">Yes</label>
                    <input type="radio" id="is_pregnant_no" name="is_pregnant" value="no" required>
                    <label for="is_pregnant_no">No</label>
                </div>
                <div class="form-group">
                    <label for="sexual_partners">Number of sexual partners in lifetime?</label>
                    <select id="sexual_partners" name="sexual_partners" required>
                        <option value="">Select</option>
                        <option value="0">0</option>
                        <option value="1-3">1-3</option>
                        <option value="4-7">4-7</option>
                        <option value=">8">>8</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="first_intercourse_age">How old were you when you first had intercourse?</label>
                    <select id="first_intercourse_age" name="first_intercourse_age" required>
                        <option value="">Select</option>
                        <option value="<16 years"><16 years</option>
                        <option value="17-20 years">17-20 years</option>
                        <option value=">21 years">>21 years</option>
                        <option value="Not applicable">Not applicable</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Do you use or have you used hormonal contraceptives?</label>
                    <input type="radio" id="contraceptive_use_yes" name="contraceptive_use" value="yes" onchange="toggleContraceptiveYears()" required>
                    <label for="contraceptive_use_yes">Yes</label>
                    <input type="radio" id="contraceptive_use_no" name="contraceptive_use" value="no" onchange="toggleContraceptiveYears()" required>
                    <label for="contraceptive_use_no">No</label>
                    <div id="contraceptive_use_years" style="display:none;">
                        <label for="contraceptive_use_years">For how long?</label>
                        <select id="contraceptive_use_years" name="contraceptive_use_years">
                            <option value="">Select</option>
                            <option value="<5 years"><5 years</option>
                            <option value="5-9 years">5-9 years</option>
                            <option value=">10 years">>10 years</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="smoking_status">Do you smoke?</label>
                    <select id="smoking_status" name="smoking_status" onchange="toggleCigarettesPerDay()" required>
                        <option value="">Select</option>
                        <option value="Never">Never</option>
                        <option value="Current">Current</option>
                        <option value="Previous">Previous</option>
                    </select>
                    <div id="cigarettes_per_day" style="display:none;">
                        <label for="cigarettes_per_day">Cigarettes per day:</label>
                        <select id="cigarettes_per_day" name="cigarettes_per_day">
                            <option value="">Select</option>
                            <option value="1-9">1-9</option>
                            <option value="10-19">10-19</option>
                            <option value=">20">>20</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Have you had a pap smear, HPV test or VIA test in the past?</label>
                    <input type="radio" id="had_pap_smear_yes" name="had_pap_smear" value="yes" onchange="togglePapResult()" required>
                    <label for="had_pap_smear_yes">Yes</label>
                    <input type="radio" id="had_pap_smear_no" name="had_pap_smear" value="no" onchange="togglePapResult()" required>
                    <label for="had_pap_smear_no">No</label>
                    <div id="pap_result" style="display:none;">
                        <label for="pap_result">Was the result normal or abnormal?</label>
                        <select id="pap_result" name="pap_result">
                            <option value="">Select</option>
                            <option value="Normal">Normal</option>
                            <option value="Abnormal">Abnormal</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="hiv_status">What is your HIV status?</label>
                    <select id="hiv_status" name="hiv_status" required>
                        <option value="">Select</option>
                        <option value="Negative">Negative</option>
                        <option value="Positive">Positive</option>
                        <option value="Unknown">Unknown</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="parity">How many children have you given birth to?</label>
                    <select id="parity" name="parity" required>
                        <option value="">Select</option>
                        <option value="<5 children"><5 children</option>
                        <option value=">=5 children">>=5 children</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="marital_status">What is your marital status?</label>
                    <select id="marital_status" name="marital_status" required>
                        <option value="">Select</option>
                        <option value="Single">Single</option>
                        <option value="Married">Married</option>
                        <option value="Divorced">Divorced</option>
                    </select>
                </div>
                <button type="submit">Calculate Risk</button>
            </fieldset>
        </form>
    </div>
</body>
</html>