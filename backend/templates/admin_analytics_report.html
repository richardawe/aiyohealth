<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analytics Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        h1, h2, h3 { color: #2c3e50; }
        .section { margin-bottom: 32px; }
        .chart-img { display: block; margin: 20px auto; max-width: 500px; max-height: 350px; border: 1px solid #eee; background: #fafafa; }
        .summary-table { border-collapse: collapse; width: 100%; margin-top: 16px; }
        .summary-table th, .summary-table td { border: 1px solid #ccc; padding: 8px 12px; text-align: left; }
        .summary-table th { background: #f5f5f5; }
        .header-bar { background: #3F51B5; color: #fff; padding: 18px 0 10px 0; text-align: center; font-size: 2.1em; font-weight: bold; letter-spacing: 2px; margin-bottom: 18px; }
        .timestamp { text-align: right; color: #888; font-size: 1em; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="header-bar">Aiyo Health Analytics Report</div>
    <div class="timestamp">
        Generated: {% if generated_at %}{{ generated_at }}{% else %}{{ (now()|datetimeformat('%B %d, %Y, %I:%M %p')) }}{% endif %}<br>
        Period: {{ date_range }}
    </div>
    <h1>Analytics Report</h1>
    <h3>Date Range: {{ date_range }}</h3>

    <div class="section">
        <h2>Summary</h2>
        <table class="summary-table">
            <tr><th>Total Users</th><td>{{ analytics.totalUsers }}</td></tr>
            <tr><th>Screened (Yes)</th><td>{{ analytics.screeningStats.yes }}</td></tr>
            <tr><th>Screened (No)</th><td>{{ analytics.screeningStats.no }}</td></tr>
        </table>
    </div>

    <div class="section">
        <h2>Risk Category Distribution</h2>
        <table class="summary-table">
            <tr><th>Low Risk</th><td>{{ analytics.riskCategories.low }}</td></tr>
            <tr><th>Medium Risk</th><td>{{ analytics.riskCategories.medium }}</td></tr>
            <tr><th>High Risk</th><td>{{ analytics.riskCategories.high }}</td></tr>
        </table>
        {% if charts.risk %}
        <img class="chart-img" src="{{ charts.risk }}" alt="Risk Distribution Chart" />
        {% endif %}
    </div>

    <div class="section">
        <h2>Screening Status Distribution</h2>
        {% if charts.screening %}
        <img class="chart-img" src="{{ charts.screening }}" alt="Screening Status Chart" />
        {% endif %}
    </div>

    <div class="section">
        <h2>Age Group Distribution</h2>
        <table class="summary-table">
            {% for group, count in analytics.ageGroups.items() %}
            <tr><th>{{ group }}</th><td>{{ count }}</td></tr>
            {% endfor %}
        </table>
        {% if charts.age %}
        <img class="chart-img" src="{{ charts.age }}" alt="Age Group Chart" />
        {% endif %}
    </div>

    <footer style="margin-top: 40px; font-size: 13px; color: #888; text-align: center;">
        Generated by Aiyo Care Admin Dashboard
    </footer>
</body>
</html>
